<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>柚子科技</title>
		<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
		<link rel="stylesheet" type="text/css" href="../static/css/index.css"/>
	</head>	
	<body>
		
		<!-- 搜索栏 -->
		<div class="searchItem">
			<input type="text" id="searchText" class="search"/>
			<div class="btn">搜索</div>
		</div>
		
		<!-- 展示栏 -->
		<div class="display">
			<ul id="render"></ul>
		</div>
		
		
		<script type="text/javascript">
			
			$(async function(){
				const datas = await getData(100)
				render(datas)
				$('.btn')[0].onclick = function(){search(datas)}
				$('#searchText')[0].onkeydown = function(){if(event.keyCode==13) search(datas)}
			})
			
			
			
			
			//定义简介最长显示字符
			const nums = 14
			
			
			// 列表渲染函数
			function render(datas){
				let html = ''
				datas.map((data)=>{
					html += `<li>
					<a href="${data.href}">
						<img src="${data.img}">
						<div class="content">
							名称：<span>${data.name}</span><br>
							类型：<span>${data.type}</span><br>
							简介：<span title="${data.doc}">${data.doc.length>nums ? data.doc.slice(0,nums)+'...' : data.doc}</span>
						</div>
					</a>
				</li>`
				})
				$('#render').html(html)
			}
			
			//获取数据函数
			async function getData(){
				let data = await $.get('/list/getdata')
				return data
			}
			
			function search(datas){
				$('#searchText')[0].select()
				let text = $('#searchText').val()
				let result = []
				datas.map((v)=>{
					let end = JSON.stringify(v)
					if(end.indexOf(text)>-1){
						result.push(JSON.parse(end))
					}
				})
				result.length>0 ? render(result) : alert('很抱歉，没有搜到你想要的')
			}
		</script>
		
	</body>
</html>
